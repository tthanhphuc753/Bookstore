<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
          crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <style>
        :root {
            --white: #fff;
            --black: #000000;
            --text-color: #333333;
            --border: 0.1rem solid rgba(0, 0, 0, 0.1);
        }

        *{
            box-sizing: inherit;
        }

        .html{
            font-size: 70%;
            line-height: 1.6rem;
            font-family: 'Poppins', sans-serif;
            box-sizing: border-box;
            overflow-x: auto;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.9rem 7%;
            background-color: #0bb7c4;
        }

        .header_navbar {
            display: flex;
            margin-top: 16px;
            justify-content: space-between;
        }

        .header_navbar_list {
            list-style: none;
            padding-left: 0;
            display: flex;
        }

        .header_navbar_item{
            margin: 0 4px;
            font-size: 1.2rem;
            text-decoration: none;
            font-weight: 300;
            display: inline-block;
            font-family: 'Poppins', sans-serif;
        }

        .header_navbar_item a{
            text-decoration: none;
            color: white;
        }

        .header_navbar_item_separate::after {
            content: "";
            display: inline-block;
            width: 1px;
            height: 15px;
            background-color: #fff;
            margin-left: 7px;
            vertical-align: middle;
        }

        .logo {
            font-size: 1.8rem;
            color: var(--white);
            font-weight: bolder;
        }

        .search-form {
            width: 40rem;
            height: 2.2rem;
            border: var(--border);
            overflow: hidden;
            background-color: var(--white);
            display: flex;
            align-items: center;
            border-radius: 1rem;
        }

        .search-form input {
            font-size: 1.2rem;
            padding: 0 1.2rem;
            height: 100%;
            width: 100%;
            text-transform: none;
            color: var(--black);
            border: none;
            outline: none;
        }

        .search-form button {
            font-size: 1.3rem;
            padding-right: 1rem;
            color: var(--black);
            cursor: pointer;
            background: none;
            border: none;
            outline: none;
        }

        .book-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .category-list {
            width: 200px;
            padding: 20px;
            background-color: #f4f4f4;
            margin-left: 20px;
            margin-top: 10px;
            border-radius: 8px;
        }

        .category-list ul{
            list-style: none;
            padding-left: 0;
        }

        .category-list li{
            margin-bottom: 10px;
        }

        .category-list li button {
            text-decoration: none;
            color: black;
            position: relative;
            display: inline-block;
            border: none;
        }

        .category-list li button::after {
            content: '';
            display: block;
            width: 0;
            height: 2px;
            background: black;
            transition: width 0.3s;
        }

        .category-list li button:hover::after {
            width: 100%;
        }

        .book-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            gap: 40px;
            padding: 10px;
            box-sizing: border-box;
            flex-grow: 1;
            max-width: 1180px;
        }

        .book {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 250px;
            box-sizing: border-box;
            text-align: center;
        }

        .book img{
            width: 160px;
            height: 120px;
        }

        /* CSS cho nút "Add to Cart" */
        .book button {
            margin-top: 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .book button:hover {
            background-color: #0056b3;
        }

        /* CSS cho phần tử danh mục */
        .category {
            font-weight: bold;
            color: #333;
            margin-top: 8px;
        }

        .header_cart_icon {
            font-size: 25px;
            color: #fff;
            cursor: pointer;
            margin: 0 4px;
        }

        #cartModal {
            display: none;
            position: fixed;
            top: 100px;
            right: 0px;
            width: 300px;
            height: 60%;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            z-index: 1;
            border-radius: 20px;
        }

        .modal-content {
            padding: 20px;
            height: auto;
            text-align: fixed;
            border: none;
            width: 93%;
        }

        .modal-content h2{
            font-size: 1.7rem;
        }

        .close {
            position: absolute;
            top: 10px;
            left: 20px;
            font-size: 25px;
            cursor: pointer;
        }

        #cartModal .modal-content {
            position: relative;
        }

        #cartModal h2 {
            margin-top: 20px;
        }

        #cartItems {
            list-style: none;
            padding: 0;
            position: relative;
        }

        #cartItems li {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 10px;
        }

        #cartItems li span {
            flex-grow: 1;
        }

        #cartItems li input {
            width: 35px;
            margin: 0 10px;
        }

        #cartItems li button {
            background-color: #ff5555;
            color: #fff;
            border: none;
            padding: 5px 8px;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-left: 5px;
        }

        #cartItems li button:hover {
            background-color: #cc0000;
        }

        button.delete-button:hover {
            background-color: #cc0000;
        }

        .total-amount {
            position: absolute;
            top: -70px;
            right: 0;
            margin: 10px;
            font-weight: bold;
        }

        #quantityLimitModal {
            box-sizing: content-box;
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            z-index: 2;
            padding: 20px;
            border-radius: 8px;
            width: 300px;
            height: 150px;
            text-align: center; /* Đặt chữ giữa theo chiều ngang */
        }

        #quantityLimitModal p {
            margin-top: 20px;
            text-align: center;
        }

        #quantityLimitModal .modal-content1 {
            padding: 10px;
            background-color: none;
            border-radius: 4px;
        }

        .closeNotice{
            box-sizing: content-box;
            position: absolute;
            width: 70px;
            height: 30px;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            line-height: 30px;
            cursor: pointer;
            background-color: #007bff;
            color: #fff;
            border:none;
            border-radius: 4px;
            font-family: 'Poppins', sans-serif;
        }

        /* Thêm hiệu ứng đẹp mắt cho modal */
        #quantityLimitModal .modal-content1 {
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        footer {
            background-color: #0bb7c4;
            color: #fff;
            text-align: center;
            padding: 15px;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
        }

        footer p{
            margin-top: 0px;
            margin-bottom: auto;
            font-family: 'Poppins', sans-serif;
        }
        body{
            margin-bottom: 60px;
        }
    </style>
</head>
<body>
<div class="main">
    <!-- header section start -->
    <header class="header">
        <div class="logo"><i class="fas fa-book"> BOOKSTORE</i> </div>

        <div class="search-form">
            <input type="search" id="search-input" placeholder="Search here..">
            <button type="submit" onclick="searchBook()" class="fas fa-search"></button>
        </div>

        <div class="header_cart_icon" onclick="openCartModal()">
            <i class="fas fa-shopping-cart"></i>
            <span id="cartItemCount">0</span>
        </div>

        <nav class="header_navbar">
            <ul class="header_navbar_list">
                <li class="header_navbar_item header_navbar_item_separate"><a th:href="@{/auth/registration-form}">Đăng ký</a></li>
                <li class="header_navbar_item"><a th:href="@{/auth/login}">Đăng nhập</a></li>
            </ul>
        </nav>
    </header>
</div>

<section class="book-section">
    <div class="category-list">
        <h3>Danh mục sách</h3>
        <ul id="categoryFilterList">
            <li><button id="allBooks" class="button-value">Tất Cả</button></li>
            <li><button id="fantasyBooks" class="button-value">Sách Huyền Bí</button></li>
            <li><button id="scienceBooks" class="button-value">Sách Khoa Học</button></li>
            <li><button id="programmingBooks" class="button-value">Sách Lập Trình</button></li>
            <li><button id="englishBooks" class="button-value">Sách Tiếng Anh</button></li>
            <li><button id="novelBooks" class="button-value">Tiểu Thuyết</button></li>
        </ul>
    </div>

    <div class="book-container" id="product-list">

    </div>

    <!-- Thêm div này cho nội dung giỏ hàng -->
    <div id="cartModal" class="modal">
        <div class="modal-content">
            <h2>Giỏ hàng của bạn</h2>
            <ul id="cartItems"></ul>
        </div>
        <span class="close" onclick="closeCartModal()">&times;</span>
    </div>

</section>
    <div id="quantityLimitModal" class="modal">
        <div class="modal-content1">
            <p>Số lượng tối đa là 20 cho mỗi sản phẩm!</p>
        </div>
        <button class="closeNotice" onclick="closeQuantityLimitModal()">Đã hiểu</button>
    </div>

<footer>
    <p>&copy; 2023 Bookstore. All rights reserved.</p>
</footer>
<script>
    // Dữ liệu mẫu cho các cuốn sách
        const books = [
          { id: 1, title: 'Book Title 1', price: 19.99, category: 'Sách Huyền Bí' },
          { id: 2, title: 'Book Title 2', price: 24.99, category: 'Sách Khoa Học' },
          { id: 3, title: 'Book Title 3', price: 14.99, category: 'Tiểu Thuyết' },
          { id: 4, title: 'Book Title 4', price: 20.99, category: 'Sách Lập Trình' },
          { id: 5, title: 'Book Title 5', price: 12.99, category: 'Sách Tiếng Anh' },
          { id: 6, title: 'Book Title 6', price: 9.99, category: 'Sách Tiếng Anh' },
          { id: 7, title: 'Book Title 7', price: 10.99, category: 'Tiểu Thuyết' },
          { id: 8, title: 'Book Title 8', price: 11.99, category: 'Sách Huyền Bí' },
          { id: 9, title: 'Book Title 9', price: 21.99, category: 'Sách Khoa Học' },
          { id: 10, title: 'Book Title 10', price: 13.99, category: 'Sách Lập Trình' },
        ];

        // Giỏ hàng để lưu trữ các mục đã chọn
        const cart = [];

        function updateCartItemCount() {
            console.log('Update cart items:', cart);
            const cartItemCountElement = document.getElementById('cartItemCount');
            if (cartItemCountElement) {
                const totalCount = cart.reduce((total, item) => total + item.quantity, 0);
                cartItemCountElement.textContent = totalCount.toString();
            }
        }

        function updateCartItemQuantity(index, newQuantity) {
            const item = cart[index];
            newQuantity = Math.max(1, Math.min(newQuantity, 20));
            item.quantity = newQuantity;
            displayCartItems();
            updateCartItemCount();
        }

        // Hàm để mở modal giỏ hàng
        function openCartModal() {
            console.log("Open cart modal");
            const modal = document.getElementById('cartModal');
            modal.style.display = 'block';
            displayCartItems();
            updateCartItemCount();
        }

        // Hàm để đóng modal giỏ hàng
        function closeCartModal() {
            console.log("Close cart modal");
            const modal = document.getElementById('cartModal');
            modal.style.display = 'none';
            updateCartItemCount();
        }

        function openQuantityLimitModal() {
            const modal = document.getElementById('quantityLimitModal');
            modal.style.display = 'block';
        }

        function closeQuantityLimitModal() {
            const modal = document.getElementById('quantityLimitModal');
            modal.style.display = 'none';
        }

    // Hàm để thêm một cuốn sách vào giỏ hàng
        function addToCart(bookId) {
            const book = books.find(item => item.id === bookId);
            if (book) {
                // Kiểm tra xem sách đã tồn tại trong giỏ hàng chưa
                const existingItem = cart.find(item => item.book.id === book.id);
                if (existingItem) {
                    // Nếu sách đã tồn tại, kiểm tra số lượng
                    if (existingItem.quantity < 20) {
                        existingItem.quantity += 1;
                    } else {
                        openQuantityLimitModal();
                    }
                } else {
                    // Nếu sách chưa tồn tại, thêm vào giỏ hàng với số lượng là 1
                    cart.push({ book, quantity: 1 });
                }
                displayCartItems();
                updateCartItemCount();
            } else {
                console.log('Failed');
            }
        }

        function removeCartItem(bookId) {
            const bookIndex = cart.findIndex(item => item.book.id === bookId);
            if (bookIndex !== -1) {
                // Xóa ngay lập tức không quan tâm đến số lượng
                cart.splice(bookIndex, 1);
                displayCartItems();
                updateCartItemCount();
            }
        }

         // Gán sự kiện onclick cho các nút thể loại sách
        document.getElementById('allBooks').onclick = () => displayFilteredBooks('Tất Cả');
        document.getElementById('fantasyBooks').onclick = () => displayFilteredBooks('Sách Huyền Bí');
        document.getElementById('scienceBooks').onclick = () => displayFilteredBooks('Sách Khoa Học');
        document.getElementById('programmingBooks').onclick = () => displayFilteredBooks('Sách Lập Trình');
        document.getElementById('englishBooks').onclick = () => displayFilteredBooks('Sách Tiếng Anh');
        document.getElementById('novelBooks').onclick = () => displayFilteredBooks('Tiểu Thuyết');

        function displayFilteredBooks(category) {
            let filteredBooks;
            if (category === 'Tất Cả') {
                // Hiển thị tất cả sách nếu là 'Tất Cả'
                filteredBooks = books;
            } else {
                // Lọc sách theo thể loại
                filteredBooks = books.filter(book => book.category === category);
                console.log('Filtering books by category:', category);
            }
             // Hiển thị danh sách sách đã lọc
                displayBooks(filteredBooks);
            }


        // Hàm để hiển thị các mục giỏ hàng trong modal
        function displayCartItems() {
            console.log('Displaying cart items:', cart);
            const cartItemsElement = document.getElementById('cartItems');
            cartItemsElement.innerHTML = '';

            let totalAmount = 0; // Tổng số tiền trong giỏ hàng

            cart.forEach((item, index) => {
                const li = document.createElement('li');

                const bookInfo = document.createElement('span');
                bookInfo.textContent = `${item.book.title} - $${(item.book.price * item.quantity).toFixed(2)} `;
                li.appendChild(bookInfo);

                // Thêm nút trừ
                const decrementButton = document.createElement('button');
                decrementButton.innerHTML = '<i class="fa-solid fa-minus"></i>';
                decrementButton.onclick = () => updateCartItemQuantity(index, item.quantity - 1);
                li.appendChild(decrementButton);

                const quantityInput = document.createElement('input');
                quantityInput.type = 'number';
                quantityInput.value = item.quantity;
                quantityInput.min = 1;
                quantityInput.max = 20;
                // Sử dụng sự kiện change để cập nhật giá trị khi có thay đổi
                quantityInput.addEventListener('change', (event) => {
                    const newValue = parseInt(event.target.value, 10);
                    // Nếu giá trị là rỗng hoặc null, đặt giá trị mặc định là 1
                    updateCartItemQuantity(index, isNaN(newValue) ? 1 : newValue);
                });
                li.appendChild(quantityInput);

                // Thêm nút cộng
                const incrementButton = document.createElement('button');
                incrementButton.innerHTML = '<i class="fa-solid fa-plus"></i>';
                incrementButton.onclick = () => updateCartItemQuantity(index, item.quantity + 1);
                li.appendChild(incrementButton);

                const deleteButton = document.createElement('button');
                deleteButton.innerHTML = '<i class="fa-solid fa-trash"></i>';
                deleteButton.className = 'delete-button';
                deleteButton.onclick = () => removeCartItem(item.book.id);
                li.appendChild(deleteButton);

                cartItemsElement.appendChild(li);

                // Cộng thêm vào tổng số tiền
                totalAmount += item.book.price * item.quantity;
            });

            // Hiển thị tổng số tiền
            const totalAmountElement = document.createElement('p');
            totalAmountElement.textContent = `Tổng số tiền: $${totalAmount.toFixed(2)}`;
            totalAmountElement.className = 'total-amount';
            cartItemsElement.insertBefore(totalAmountElement, cartItemsElement.firstChild);
        }



    // Hàm để hiển thị danh sách danh mục sách
        function displayCategoryList() {
            const categoryFilterList = document.getElementById('categoryFilterList');
            const categories = [...new Set(books.map(book => book.category))];

            categories.forEach(categoryFilterList => {
                const li = document.createElement('li');
                const button = document.createElement('button');
                button.className = 'button-value';
                button.onclick = () => displayFilteredBooks(category);
                li.appendChild(button);
                categoryFilterList.appendChild(li);
            });
        }

        // Hàm để hiển thị sách dựa trên danh sách được cung cấp
        function displayBooks(books) {
            const bookListContainer = document.getElementById('product-list');
            bookListContainer.innerHTML = '';

            books.forEach(book => {
                const bookDiv = document.createElement('div');
                bookDiv.className = 'book';

                const img = document.createElement('img');
                img.src = `../static/img/${book.title.replace(/\s+/g, '')}.jfif`;
                img.alt = book.title;
                bookDiv.appendChild(img);

                const title = document.createElement('h2');
                title.textContent = book.title;
                bookDiv.appendChild(title);

                const author = document.createElement('p');
                author.textContent = `Author: ${book.author || 'Unknown'}`;
                bookDiv.appendChild(author);

                const category = document.createElement('p'); // Thêm phần hiển thị danh mục
                category.textContent = `Category: ${book.category || 'Unknown'}`;
                bookDiv.appendChild(category);

                const price = document.createElement('p');
                price.textContent = `Price: $${book.price.toFixed(2)}`;
                bookDiv.appendChild(price);

                const addToCartButton = document.createElement('button');
                addToCartButton.textContent = 'Add to Cart';
                addToCartButton.onclick = () => addToCart(book.id);
                bookDiv.appendChild(addToCartButton);

                bookListContainer.appendChild(bookDiv);
            });

        }
    displayBooks(books);
</script>

</body>
</html>

